# 🔧 관리자 기능 (Admin Features)

## 📋 개요

시스템 관리자(ADMIN 권한)가 사용할 수 있는 관리 기능들에 대한 상세 명세입니다.

## 📊 대시보드 (`/admin`)

### 주요 지표 카드
1. **회원 통계**
   - 총 회원 수
   - 신규 가입 (오늘/이번주/이번달)
   - 활성 사용자
   - 회원 증가 추이

2. **상담 현황**
   - 대기 중인 상담
   - 진행 중인 상담
   - 완료된 상담
   - 평균 처리 시간

3. **후원 통계**
   - 이번달 후원금
   - 후원자 수
   - 평균 후원액
   - 후원 증가율

4. **게시물 통계**
   - 총 게시물 수
   - 오늘 작성된 글
   - 댓글 수
   - 인기 게시물

### 실시간 모니터링
- **최근 활동 로그**
  - 회원 가입
  - 상담 신청
  - 후원 신청
  - 관리자 작업

- **시스템 상태**
  - 서버 상태
  - DB 연결 상태
  - 스토리지 사용량
  - API 응답 시간

### 차트 및 그래프
- 일별/주별/월별 통계
- 회원 증가 추이
- 상담 처리 현황
- 후원금 추이

## 👥 회원 관리 (`/admin/users`)

### 회원 목록
- **표시 정보**
  - 회원 ID
  - 이름
  - 이메일
  - 연락처
  - 가입일
  - 최근 접속
  - 상태
  - 권한

- **검색 및 필터**
  - 키워드 검색 (이름, 이메일, 전화번호)
  - 상태 필터 (활성/비활성/정지)
  - 권한 필터 (USER/ADMIN)
  - 가입일 범위
  - 정렬 (이름/가입일/최근접속)

### 회원 상세 정보
- **기본 정보**
  - 개인정보 전체
  - 프로필 사진
  - 가입 경로
  - 로그인 타입

- **활동 정보**
  - 로그인 이력
  - 상담 신청 내역
  - 후원 내역
  - 게시판 활동
  - 댓글 작성 내역

- **관리 기능**
  - 정보 수정
  - 비밀번호 초기화
  - 상태 변경
  - 권한 변경
  - 관리자 메모

### 일괄 작업
- **선택 작업**
  - 다중 선택 (체크박스)
  - 전체 선택
  - 필터 결과 선택

- **일괄 처리**
  - ✅ 상태 일괄 변경
  - ✅ 일괄 이메일 발송
  - ✅ 일괄 계정 정지
  - ✅ 일괄 삭제
  - 일괄 권한 변경 (향후)
  - 엑셀 내보내기 (향후)

### 회원 생성
- 관리자가 직접 회원 생성
- 초기 비밀번호 설정
- 환영 이메일 발송 옵션

## 📝 게시물 관리 (`/admin/posts`)

### 게시물 목록
- **관리 항목**
  - 제목
  - 카테고리
  - 작성자
  - 작성일
  - 조회수
  - 댓글 수
  - 공개 상태

- **일괄 작업**
  - 카테고리 변경
  - 공개/비공개 전환
  - 일괄 삭제
  - 고정글 설정

### 게시물 작성/수정
- **에디터 기능**
  - WYSIWYG 에디터
  - 마크다운 지원
  - 이미지 업로드
  - 파일 첨부
  - 미리보기

- **게시물 옵션**
  - 카테고리 선택
  - 공개 범위 설정
  - 댓글 허용 여부
  - 고정글 여부
  - 예약 발행

### 카테고리 관리 (`/admin/categories`)
- **카테고리 CRUD**
  - 카테고리 생성
  - 이름/설명 수정
  - 순서 변경
  - 삭제 (게시물 확인)

- **계층 구조**
  - 대분류/중분류/소분류
  - 부모-자식 관계 (parent_id)
  - 카테고리 타입 (notice, news, publication, media, resource, activity)
  - 드래그&드롭 정렬
  - 카테고리별 권한 설정

## 🖼️ 배너 관리 (`/admin/banners`) ⭐ NEW

### 배너 목록
- **표시 정보**
  - 배너 ID
  - 제목 (title)
  - 썸네일 이미지
  - 링크 URL
  - 정렬 순서 (sort_order)
  - 활성 상태 (is_active)
  - 게시 기간 (start_date ~ end_date)
  - 생성/수정일

- **필터 및 검색**
  - 활성 상태별 필터
  - 기간별 조회
  - 제목 검색

### 배너 생성/수정 (`/admin/banners/new`, `/admin/banners/[id]/edit`)
- **기본 정보**
  - 제목 (title) - 필수
  - 부제목 (subtitle)
  - 설명 (description)

- **이미지 설정**
  - 배너 이미지 업로드 (S3)
  - 이미지 경로 (image_path)
  - **그라데이션 오버레이** (image_option) ⭐ NEW
    - 어두운 그라데이션
    - 밝은 그라데이션
    - 그라데이션 없음

- **링크 설정**
  - 링크 URL (link_url)
  - 링크 타겟 (link_target)
    - `_self`: 현재 창
    - `_blank`: 새 창

- **게시 설정**
  - 정렬 순서 (sort_order)
  - 활성화 여부 (is_active)
  - 게시 시작일 (start_date)
  - 게시 종료일 (end_date)

### 배너 기능
- **이미지 업로드**
  - S3/Cloudflare R2 업로드
  - Base64 이미지 차단 (보안)
  - 이미지 URL 검증

- **일괄 작업**
  - 다중 선택 삭제 (bulk delete)
  - 배너 ID 배열로 일괄 삭제

- **관리자 로그**
  - 모든 배너 작업 기록 (생성/수정/삭제)
  - admin_logs 테이블에 자동 기록

## 🔗 퀵링크 관리 (`/admin/quick-links`) ⭐ NEW

### 퀵링크 목록
- **표시 정보**
  - 퀵링크 ID
  - 제목 (title)
  - 아이콘 (icon)
  - 링크 URL (link_url)
  - 설명 (description)
  - 정렬 순서 (sort_order)
  - 활성 상태 (is_active)
  - 외부/내부 링크 구분 (is_external)

- **정렬 기능**
  - sort_order 기준 정렬
  - 드래그&드롭 (선택 구현)

### 퀵링크 생성/수정
- **필수 정보**
  - 제목 (title) - 필수
  - 링크 URL (link_url) - 필수

- **선택 정보**
  - 아이콘 (icon) - Lucide React 아이콘 이름
  - 설명 (description)
  - 정렬 순서 (sort_order)
  - 활성화 여부 (is_active)

### 퀵링크 기능
- **자동 링크 분석**
  - URL 파싱으로 외부/내부 링크 자동 감지
  - 외부 링크: `target="_blank"` 자동 적용

- **관리자 인증**
  - Bearer 토큰 검증 (verifyAdminRequest)
  - ADMIN 권한 필수
  - 모든 작업 admin_logs에 기록

- **API 엔드포인트**
  - `GET /api/admin/quick-links` - 전체 조회 (비활성 포함)
  - `POST /api/admin/quick-links` - 생성
  - `PUT /api/admin/quick-links/[id]` - 수정
  - `DELETE /api/admin/quick-links/[id]` - 삭제

## 📚 자료실 관리 (`/admin/resources`) ⭐ ENHANCED

### 자료 관리
- **자료 목록**
  - 자료 ID, 제목, 카테고리
  - 파일 타입 (PDF, XLSX, HWP, PPT, etc.)
  - 다운로드 수, 조회 수
  - 공개 상태, 추천 여부
  - 게시일, 생성자

- **자료 CRUD**
  - 자료 생성/수정/삭제
  - S3 파일 업로드
  - 썸네일 이미지
  - 외부 링크 지원

- **권한 설정**
  - public: 공개
  - member: 회원 전용
  - premium: 프리미엄 회원
  - admin: 관리자 전용

### 자료 카테고리 관리
- **카테고리 관리**
  - 종교인소득, 비영리재정, 결산공시, 관계법령 등
  - 카테고리 CRUD
  - 아이콘 설정
  - 정렬 순서

### 태그 관리
- **태그 시스템**
  - 태그 생성/삭제
  - 자료-태그 매핑 (다대다)
  - 태그별 자료 조회

### 다운로드 로그
- **다운로드 추적**
  - 사용자별 다운로드 이력
  - IP, User Agent 기록
  - Referer 추적
  - 다운로드 통계

### 댓글 관리
- 댓글 목록
- 스팸 필터링
- 일괄 삭제
- 신고 댓글 처리

## 💼 상담 관리 (`/admin/consultations`)

### 상담 목록
- **상태별 분류**
  - 대기중 (신규)
  - 배정됨
  - 진행중
  - 완료
  - 취소

- **관리 기능**
  - 담당자 배정
  - 상태 변경
  - 우선순위 설정
  - 메모 추가

### 상담 상세
- **상담 정보**
  - 신청자 정보
  - 상담 분야
  - 상담 내용
  - 첨부 파일
  - 신청 일시

- **처리 이력**
  - 상태 변경 기록
  - 담당자 변경 기록
  - 답변 내역
  - 내부 메모

### 상담 답변
- 답변 작성
- 파일 첨부
- 템플릿 사용
- 이메일 알림 발송

### 통계 및 리포트
- 분야별 통계
- 담당자별 처리 현황
- 평균 처리 시간
- 만족도 조사 결과

## 💝 후원 관리 (`/admin/donations`)

### 후원 목록
- **후원 정보**
  - 후원자 정보
  - 후원 금액
  - 후원 일자
  - 결제 방법
  - 후원 유형

- **필터 및 검색**
  - 기간별 조회
  - 금액 범위
  - 후원 유형
  - 결제 상태

### 후원자 관리 (`/admin/sponsors`)
- **후원자 정보**
  - 개인/단체 구분
  - 총 후원 금액
  - 후원 횟수
  - 최근 후원일

- **관리 기능**
  - 후원자 등급 관리
  - 감사 메일 발송
  - 후원 증서 발급
  - 특별 관리 메모

### 정기 후원 관리
- 정기 후원자 목록
- 결제 예정 확인
- 실패 결제 처리
- 후원 중단/재개 관리

### 후원 통계
- 월별/년별 통계
- 후원 방법별 분석
- 후원자 분포
- 재후원율 분석

## ⚙️ 시스템 설정 (`/admin/settings`)

### 사이트 설정
- **기본 정보**
  - 사이트명
  - 로고/파비콘
  - 메타 정보
  - 연락처 정보

- **운영 설정**
  - 회원가입 허용
  - 댓글 작성 권한
  - 파일 업로드 제한
  - 스팸 필터 설정

### 메뉴 관리
- 메뉴 구조 편집
- 메뉴 항목 추가/삭제
- 순서 변경
- 권한별 표시 설정

### 홈페이지 구성 관리
- 메인 배너 관리 → `/admin/banners` (전용 페이지)
- 퀵링크 관리 → `/admin/quick-links` (전용 페이지)
- 팝업 관리
- 노출 기간 설정

### 이메일 템플릿
- 템플릿 편집
- 변수 설정
- 미리보기
- 테스트 발송

### API 설정
- API 키 관리
- 외부 서비스 연동
- Webhook 설정
- 사용량 모니터링

## 📊 리포트 및 통계

### 종합 리포트
- 일간/주간/월간 리포트
- 커스텀 기간 설정
- PDF/Excel 내보내기
- 이메일 정기 발송

### 상세 분석
- **회원 분석**
  - 가입 추이
  - 이탈율
  - 활성 사용자
  - 인구통계

- **콘텐츠 분석**
  - 인기 게시물
  - 조회수 통계
  - 댓글 활동
  - 검색 키워드

- **전환 분석**
  - 상담 전환율
  - 후원 전환율
  - 가입 경로 분석

## 🔍 로그 및 감사

### 활동 로그
- **관리자 활동**
  - 작업 내역
  - 변경 사항
  - 접근 기록
  - IP 추적

- **시스템 로그**
  - 에러 로그
  - 보안 이벤트
  - 성능 로그
  - API 호출 로그

### 감사 추적
- 데이터 변경 이력
- 권한 변경 기록
- 삭제 데이터 복구
- 보안 감사 리포트

## 🚨 알림 및 모니터링

### 실시간 알림
- 새 회원 가입
- 상담 신청
- 시스템 오류
- 보안 경고

### 알림 설정
- 알림 유형별 on/off
- 수신 채널 (이메일/SMS)
- 알림 그룹 설정
- 우선순위 설정

## 🛡️ 보안 관리

### 접근 제어
- IP 화이트리스트
- 2단계 인증 강제
- 세션 타임아웃 설정
- 동시 로그인 제한

### 보안 정책
- 비밀번호 정책
- 계정 잠금 정책
- 데이터 암호화
- 백업 정책

## 📱 모바일 관리 (향후 구현)

### 모바일 앱 관리
- 앱 버전 관리
- 푸시 알림 발송
- 앱 공지사항
- 강제 업데이트

## 🔍 모니터링 및 분석 (`/admin/db-monitor`)

### 데이터베이스 모니터링
- **커넥션 풀 상태**
  - 활성 커넥션 수
  - 대기 중인 요청
  - 최대 커넥션 수
  - Idle 커넥션 수

- **쿼리 성능**
  - 느린 쿼리 감지 (>1000ms)
  - 쿼리 실행 시간 통계
  - 자주 실행되는 쿼리

- **메모리 사용량**
  - Heap 사용량
  - External 메모리
  - RSS (Resident Set Size)
  - 메모리 증가 추이

- **헬스체크**
  - DB 연결 상태
  - 응답 시간
  - 에러율

### 성능 최적화
- **t2.micro 최적화**
  - 커넥션 풀 크기: 5
  - 최대 Idle: 2
  - Keep-alive 설정
  - Timeout 설정

## 🔄 데이터 관리

### 백업 및 복구
- 자동 백업 스케줄
- 수동 백업
- 복구 지점 관리
- 복구 테스트

### 데이터 정리
- 오래된 로그 삭제 (6개월 이상)
- 휴면 계정 처리
- 임시 파일 정리
- DB 최적화
- 아카이빙 전략 (posts, admin_logs 등)

## 📈 성과 지표 (KPI)

### 주요 지표
| 지표 | 목표 | 측정 주기 |
|------|------|-----------|
| 월 활성 사용자 | 1,000명 | 월간 |
| 상담 처리 시간 | 48시간 이내 | 일간 |
| 후원 전환율 | 5% | 월간 |
| 사이트 가용성 | 99.9% | 실시간 |

## 🆕 최근 추가된 관리 기능 (2025년 1월)

### 신규 관리 페이지
1. **배너 관리** (`/admin/banners`)
   - 그라데이션 오버레이 지원
   - 일괄 삭제 기능
   - 게시 기간 스케줄링

2. **퀵링크 관리** (`/admin/quick-links`)
   - 홈페이지 퀵 메뉴 구성
   - 외부/내부 링크 자동 감지
   - 아이콘 커스터마이징

3. **자료실 관리** (강화)
   - 권한별 접근 제어
   - 다운로드 추적
   - 태그 시스템

4. **DB 모니터링** (`/admin/db-monitor`)
   - 실시간 성능 모니터링
   - 느린 쿼리 감지
   - 메모리 사용량 추적

### 개선된 기능
- **관리자 로그**: 모든 배너/퀵링크 작업 자동 기록
- **이미지 업로드**: S3 직접 업로드, 보안 검증 강화
- **성능 최적화**: t2.micro 환경 최적화된 커넥션 풀

---

*최종 업데이트: 2025년 1월 29일*